query GetDashboardData($today: String, $userId: ID) {
  # 查询各个表的记录数（带权限过滤）
  customers(filter: { user_created: { id: { _eq: $userId } } }, limit: 1000) {
    id
  }
  products(filter: { user_created: { id: { _eq: $userId } } }, limit: 1000) {
    id
  }
  orders(filter: { user_created: { id: { _eq: $userId } } }, limit: 1000) {
    id
  }
  categories(filter: { user_created: { id: { _eq: $userId } } }, limit: 1000) {
    id
  }
  boutiques(filter: { user_created: { id: { _eq: $userId } } }, limit: 1000) {
    id
  }
  terminals(filter: { user_created: { id: { _eq: $userId } } }, limit: 1000) {
    id
  }
  views(filter: { user_created: { id: { _eq: $userId } } }, limit: 1000) {
    id
  }
  visits(filter: { user_created: { id: { _eq: $userId } } }, limit: 1000) {
    id
  }
  
  # 使用聚合查询获取总数（带权限过滤）
  customers_aggregated(filter: { user_created: { id: { _eq: $userId } } }) {
    countAll
  }
  products_aggregated(filter: { user_created: { id: { _eq: $userId } } }) {
    countAll
  }
  orders_aggregated(filter: { user_created: { id: { _eq: $userId } } }) {
    countAll
  }
  categories_aggregated(filter: { user_created: { id: { _eq: $userId } } }) {
    countAll
  }
  boutiques_aggregated(filter: { user_created: { id: { _eq: $userId } } }) {
    countAll
  }
  terminals_aggregated(filter: { user_created: { id: { _eq: $userId } } }) {
    countAll
  }
  views_aggregated(filter: { user_created: { id: { _eq: $userId } } }) {
    countAll
  }
  visits_aggregated(filter: { user_created: { id: { _eq: $userId } } }) {
    countAll
  }
  
  # 今日订单（带权限过滤）
  today_orders: orders(filter: { 
    date_created: { _gte: $today },
    user_created: { id: { _eq: $userId } }
  }) {
    id
    status
  }
}

# 管理员仪表盘数据（无权限过滤）
query GetAllDashboardData($today: String) {
  # 直接查询各个表的记录数 - 使用较小的限制以验证数据存在
  customers(limit: 1000) {
    id
  }
  products(limit: 1000) {
    id
  }
  orders(limit: 1000) {
    id
  }
  categories(limit: 1000) {
    id
  }
  boutiques(limit: 1000) {
    id
  }
  
  # 使用聚合查询获取总数
  customers_aggregated {
    countAll
  }
  products_aggregated {
    countAll
  }
  orders_aggregated {
    countAll
  }
  categories_aggregated {
    countAll
  }
  boutiques_aggregated {
    countAll
  }
  
  # 今日订单
  today_orders: orders(filter: { 
    date_created: { _gte: $today } 
  }) {
    id
    status
  }
}

query GetRecentOrders($limit: Int = 5, $userId: ID) {
  orders(filter: { user_created: { id: { _eq: $userId } } }, limit: $limit, sort: ["-date_created"]) {
    id
    customer {
      id
      nick_name
    }
    total_price
    status
    date_created
  }
}

# 管理员最近订单（无权限过滤）
query GetAllRecentOrders($limit: Int = 5) {
  orders(limit: $limit, sort: ["-date_created"]) {
    id
    customer {
      id
      nick_name
    }
    total_price
    status
    date_created
  }
}
